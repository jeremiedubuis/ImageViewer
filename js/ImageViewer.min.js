var ImageViewer=function(){var a=function(){for(var a=1;a<arguments.length;a++)for(var b in arguments[a])arguments[a].hasOwnProperty(b)&&(arguments[0][b]=arguments[a][b]);return arguments[0]},b=function(a){var b=a.getBoundingClientRect();return{top:b.top+document.body.scrollTop,left:b.left+document.body.scrollLeft}},c=function(a,b,c){this.container=a,this.bar=b,this.vertical=c||!1,this.init()};c.prototype={init:function(){this.fn={startSlide:this.startSlide.bind(this),moveSlide:this.moveSlide.bind(this),stopSlide:this.stopSlide.bind(this)},this.percent=0,this.setSize(),this.container.addEventListener("mousedown",this.fn.startSlide,!1),document.addEventListener("mousemove",this.fn.moveSlide,!1),document.addEventListener("mouseup",this.fn.stopSlide,!1)},setSize:function(){var a=this.container.style.display,c=this.container.parentNode.style.display;this.container.style.display="block",this.container.parentNode.style.display="block",this.vertical?(this.max=this.container.offsetHeight,this.bar.style.maxHeight=this.max+"px",this.emptyOffset=b(this.container).top+this.max):(this.max=this.container.offsetWidth,this.bar.style.maxWidth=this.max+"px",this.emptyOffset=b(this.container).left),this.percentSize=this.max/100,this.container.style.display=a,this.container.parentNode.style.display=c},startSlide:function(a){this.sliding=!0,this.set(a)},moveSlide:function(a){this.sliding&&this.set(a)},offsetToPercent:function(a){var b=(a-this.emptyOffset)/this.percentSize;return this.vertical?0>=b?Math.abs(b):0:b>=0?b:0},set:function(a){this.percent=this.offsetToPercent(this.vertical?a.pageY:a.pageX),this.bar.style[this.vertical?"height":"width"]=this.percent+"%",this.onChange(Math.min(100,Math.max(0,this.percent)))},stopSlide:function(a){this.sliding=!1},value:function(a,b){return"undefined"==typeof a?this.percent:(this.percent=a,this.bar.style[this.vertical?"height":"width"]=this.percent+"%",("undefined"==typeof b||b)&&this.onChange(this.percent),this)},onChange:function(){},destroy:function(){document.removeEventListener("mousemove",this.fn.moveSlide,!1),document.removeEventListener("mouseup",this.fn.stopSlide,!1),this.container.removeEventListener("mousedown",this.fn.startSlide)}};var d=function(b,c){var d={minScale:.7,maxScale:1.5,src:b,canvas:document.getElementsByTagName("canvas")[0],dragSmall:!1,hasSlider:!0,sliderOptions:{zoom:document.getElementsByClassName("zoom")[0],slider:document.getElementsByClassName("zoom")[0].getElementsByClassName("slider")[0]},onLoad:function(a){},onScale:function(a){}};a(this,a(d,c)),this.init()};return d.prototype={init:function(){this.img=new Image,this.c2d=this.canvas.getContext("2d"),this.scale=this.minScale,this.workspace={width:this.canvas.parentNode.offsetWidth,height:this.canvas.parentNode.offsetHeight,ratio:this.canvas.parentNode.offsetWidth/this.canvas.parentNode.offsetHeight},this.offset={x:0,y:0},this.load(),this.addListeners()},addListeners:function(){this.fn={onPointerDown:this.onPointerDown.bind(this),onPointerMove:this.onPointerMove.bind(this),onPointerUp:this.onPointerUp.bind(this),onPointerDown:this.onPointerDown.bind(this)},this.canvas.addEventListener("mousedown",this.fn.onPointerDown,!1),this.canvas.addEventListener("mousemove",this.fn.onPointerMove,!1),document.addEventListener("mouseup",this.fn.onPointerUp,!1),this.canvas.addEventListener("touchstart",this.fn.onPointerDown,!1),this.canvas.addEventListener("touchmove",this.fn.onPointerMove,!1),document.addEventListener("touchend",this.fn.onPointerUp,!1)},load:function(){var a=this;this.img.onload=function(){a._onLoad(a.img)},this.img.src=this.src},_onLoad:function(a){this.original={width:a.width,height:a.height,src:a.src,ratio:a.width/a.height},this.setSize(),this.scale<1&&(this.offset.x=.5*(this.canvas.width-this.canvas.width*this.scale),this.offset.y=.5*(this.canvas.height-this.canvas.height*this.scale)),this.draw(),this.hasSlider&&this.sliderInit(),this.onLoad(this)},setSize:function(){var a,b,c=this.original.width,d=this.original.height,e=c>this.workspace.width,f=d>this.workspace.height;e||f?(a=e?this.workspace.width:c,b=f?this.workspace.height:d,a>b?b=a/this.original.ratio:a=b*this.original.ratio):(a=c,b=d),this.canvas.width=a,this.canvas.height=b,this.percentageOfOriginal=this.workspace.width*this.scale/this.original.width*100},setCenter:function(){this.setCenterAxis("x"),this.setCenterAxis("y")},setCenterAxis:function(a){var b="x"===a?"width":"height",c=.5*this.workspace[b],d=this.offset[a]-c,e=d/(this.workspace[b]*this.prevScale/2);this.offset[a]=this.workspace[b]*this.scale*e/2+c},draw:function(){this.c2d.drawImage(this.img,this.offset.x,this.offset.y,this.canvas.width*this.scale,this.canvas.height*this.scale)},darken:function(a,b,c,d){this.c2d.save(),this.c2d.globalAlpha=.5,this.c2d.fillStyle="black",this.c2d.fillRect(0,0,this.canvas.width,this.canvas.height),this.c2d.restore(),this.c2d.save(),this.c2d.beginPath(),this.c2d.clearRect(a,b,c,d),this.c2d.rect(a,b,c,d),this.c2d.clip(),this.c2d.drawImage(this.img,this.offset.x,this.offset.y,this.canvas.width*this.scale,this.canvas.height*this.scale),this.c2d.restore()},zoom:function(a,b,c){this.prevScale=this.scale,this.scale=a,this.prevScale!==this.scale&&(this.setSize(),this.setCenter(),this.offset.x=b||this.offset.x,this.offset.y=c||this.offset.y,this.c2d.clearRect(0,0,this.canvas.width,this.canvas.height),this.clamp(this.offset.x,this.offset.y),this.draw())},clamp:function(a,b){this.clampAxis("x",a),this.clampAxis("y",b)},clampAxis:function(a,b){b=b?b:this.offset[a];var c="x"===a?"width":"height",d=this.canvas[c]*this.scale,e=this.workspace[c],f=e>d?e-d:0,g=e>d?0:e-d;this.offset[a]=Math.min(f,Math.max(b,g))},onPointerDown:function(a){this.dragging=!0,console.log(a),this.drag={x:a.pageX,y:a.pageY}},onPointerMove:function(a){this.dragging&&(this.setSize(),this.offset.x+=a.pageX-this.drag.x,this.drag.x=a.pageX,this.offset.y+=a.pageY-this.drag.y,this.drag.y=a.pageY,this.clamp(),this.draw())},onPointerUp:function(a){this.dragging&&(this.onPointerMove(a),this.dragging=!1)},sliderInit:function(){var a=this;this.slider=new c(this.sliderOptions.zoom,this.sliderOptions.slider),this.slider.onChange=function(b){var c=a.maxScale-a.minScale;a.zoom(c/100*b+a.minScale),a.onScale(b)}},destroy:function(){this.canvas.removeEventListener("mousedown",this.fn.onPointerDown,!1),this.canvas.removeEventListener("mousemove",this.fn.onPointerMove,!1),document.removeEventListener("mouseup",this.fn.onPointerUp,!1),this.canvas.removeEventListener("touchstart",this.fn.onPointerDown,!1),this.canvas.removeEventListener("touchmove",this.fn.onPointerMove,!1),document.removeEventListener("touchend",this.fn.onPointerUp,!1),this.slider&&this.slider.destroy()}},d}();